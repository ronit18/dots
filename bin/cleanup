#!/usr/bin/env bash

read -p "WARNING: This script will perform a COMPLETE macOS cleanup, including deleting caches, logs, and backups. This action is irreversible. Are you ABSOLUTELY sure you want to proceed? [y/N]: " -n 1 -r
echo
if [[ ! $REPLY =~ ^[Yy]$ ]]; then
    echo "Cleanup canceled."
    exit 1
fi

# --- Trash Cleanup ---
echo "Emptying Trash on all volumes..."
sudo rm -rf /Volumes/*/.Trashes &>/dev/null
sudo rm -rf ~/.Trash/* &>/dev/null

# --- System Log Files (More Specific) ---
echo "Clearing system log files..."
sudo rm -rf /private/var/log/asl/*.asl &>/dev/null        # ASL logs
sudo rm -rf /Library/Logs/DiagnosticReports/* &>/dev/null # Diagnostic reports
sudo rm -rf /Library/Logs/CrashReporter/* &>/dev/null     # Crash reporter logs
# Consider removing: sudo rm -rf /Library/Logs/*  # Be cautious with broad log deletion
# Consider removing: sudo rm -rf /var/log/* # Be very cautious with /var/log

# --- Mail Logs ---
rm -rf ~/Library/Containers/com.apple.mail/Data/Library/Logs/Mail/* &>/dev/null

# --- Simulator Logs ---
rm -rf ~/Library/Logs/CoreSimulator/* &>/dev/null

# --- iOS Applications ---
echo "Cleaning up iOS applications..."
rm -rf ~/Music/iTunes/iTunes\ Media/Mobile\ Applications/* &>/dev/null

# --- iOS Device Backups ---
echo "Removing iOS device backups..."
rm -rf ~/Library/Application\ Support/MobileSync/Backup/* &>/dev/null

# --- XCode Cleanup ---
echo "Cleaning up XCode data..."
rm -rf ~/Library/Developer/Xcode/DerivedData/* &>/dev/null
rm -rf ~/Library/Developer/Xcode/Archives/* &>/dev/null

# --- Homebrew Cleanup ---
echo "Cleaning up Homebrew cache..."
brew cleanup --force -s &>/dev/null # Already aggressive cleanup
# rm -rf /Library/Caches/Homebrew/* &>/dev/null # Potentially redundant
brew tap --repair &>/dev/null

# --- Ruby Gems Cleanup ---
echo "Cleaning up Ruby gems..."
gem cleanup &>/dev/null

# --- npm Cleanup ---
echo "Cleaning up npm cache..."
npm cache clean --force &>/dev/null # Already forceful
# rm -rf ~/.npm &>/dev/null # Potentially redundant and risky

# --- Mail Downloads Cleanup ---
echo "Cleaning up Mail Downloads..."
rm -rf ~/Library/Mail\ Downloads # Mail Downloads

# --- Quick Look Cache Reset ---
echo "Resetting Quick Look cache..."
qlmanage -r cache &>/dev/null
qlmanage -r thumbnails &>/dev/null

# --- Temporary Files (Cautious Approach - Consider Removing Entirely) ---
echo "Clearing temporary files (cautious)..."
# sudo rm -rf /private/var/folders/* &>/dev/null # Very broad, consider removing

# --- User Cache Cleanup ---
echo "Clearing user cache files..."
rm -rf ~/Library/Caches/* &>/dev/null

# --- Purge Inactive Memory ---
echo "Purging inactive memory..."
sudo purge &>/dev/null

echo "Cleanup completed! 🎉"
